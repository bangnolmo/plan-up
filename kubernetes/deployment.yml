apiVersion: apps/v1
kind: Deployment
metadata:
    name: nextjs-deployment
    namespace: frontend
    labels:
        app: nextjs
spec:
    replicas: 1 # HPA가 관리하므로 기본값으로 최소 1로 설정
    selector:
        matchLabels:
            app: nextjs
    template:
        metadata:
            labels:
                app: nextjs
        spec:
            affinity:
                nodeAffinity:
                    requiredDuringSchedulingIgnoredDuringExecution:
                        nodeSelectorTerms:
                            - matchExpressions:
                                  - key: dedicated
                                    operator: In
                                    values:
                                        - frontend
            containers:
                - name: nextjs
                  image: heung115/my-nextjs-app:latest
                  envFrom:
                      - secretRef:
                            name: frontend-secrets
                      - configMapRef:
                            name: frontend-config
                  ports:
                      - containerPort: 3000
                  resources:
                      requests:
                          cpu: "250m"
                          memory: "256Mi"
                      limits:
                          cpu: "500m"
                          memory: "512Mi"
